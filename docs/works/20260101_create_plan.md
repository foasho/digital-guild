# 計画書作成の思考プロセス

**作成日**: 2026年1月1日
**対象**: Phase 1 モックシステム構築計画

---

## 1. 背景と目的

ユーザーから `/create-plan` コマンドで `docs/context/phase1-mock-system.md` を参照し、frontend内にモックシステムを構築する計画書の作成を依頼された。作業が膨大になるため、`tasks/` 直下に計画書を複数に分けて作成することが求められた。

---

## 2. 情報収集のプロセス

### 2.1 プロジェクト構造の把握

最初に以下を確認した：

1. **プロジェクトルート構造**
   - `frontend/`: 新規Next.js 16プロジェクト（基本セットアップ済み）
   - `backup/`: 既存の類似システム実装（参考用）
   - `docs/figma/`: UIデザインファイル
   - `tasks/`: 計画書の格納先

2. **既存frontend/の状態**
   - Next.js 16.1.1 + React 19.2.3
   - Tailwind CSS 4 + Biome
   - 基本的なファイル構造のみ（app/page.tsx, layout.tsx）

3. **backupフォルダの分析**
   - 完全な実装が存在（参考になるが「引っ張られすぎない」との指示）
   - CLAUDE.mdに詳細な設計ドキュメント
   - Zustandストア、コンポーネント、型定義の構造を把握

### 2.2 デザインファイルの確認

`docs/figma/` 配下の画像を視覚的に確認：
- `base.png`: 共通レイアウト（ヘッダー、ギルド証カード、フッター）
- `board.png`: 掲示板UI（ジョブカード、検索バー）
- `map.png`: マップUI（Leafletピン表示）
- `wallet.jpg`: ウォレットUI（バーコード、QR、取引履歴）
- `detail-modal.png`: 詳細モーダルUI

### 2.3 アセットファイルの存在確認

`frontend/public/` 配下に必要なアセットがすべて揃っていることを確認：
- `icons/`: board.png, map.png, job.png, wallet.png, trust.png
- `backgrounds/`: morning.png, noon.png, night.png
- `jobs/`: izakaya.jpg, nouka.png, ryokan.png
- `logo/`: barcode.png, qr.png, jpyc.png
- `avatar4.png`

---

## 3. 設計判断のポイント

### 3.1 仕様書からの変更点の抽出

backup（既存システム）と仕様書を比較し、以下の変更点を特定：

| 項目 | backup | 新仕様 |
|------|--------|--------|
| ユーザー名称 | users | workers |
| ジョブ名称 | quests | jobs |
| 信用ポイント MAX | 200 | 100 |
| 評価軸 | 4軸（AI含む） | 1軸（人間評価のみ） |
| 評価フロー | 完了報告→依頼者承認→AI判定→取引 | 完了報告→依頼者承認→取引 |
| UIフレームワーク | 独自Tailwind | HeroUI |

### 3.2 不明確な点の確認

仕様書で明確でない以下の点をユーザーに質問：

1. **AIレコメンド機能**: モックデータか実際のGemini API呼び出しか
   → **回答**: 実際にGemini APIを呼び出す。`lib/gemini/`に処理をまとめる

2. **発注者ページの範囲**: 4画面すべてか最小限か
   → **回答**: すべて実装

3. **ジョブページの仕様**: 未記載だったため確認
   → **回答**: 着手中・完了済みジョブの確認ページ

### 3.3 技術スタック確認

仕様書で指定された技術スタック：
- next: 16.1.1, react: 19.2.3, react-dom: 19.2.3
- zustand（状態管理）
- HeroUI + tailwindcss（UI）
- zod（バリデーション）
- es-toolkit（ユーティリティ、debounce用）
- leaflet（マップ）
- biome（Linter/Formatter）
- **Bun**（パッケージマネージャー）← 後から確認

---

## 4. フェーズ分割の考え方

### 4.1 分割の基準

以下の基準でフェーズを分割：

1. **依存関係**: 後続フェーズが前提とする成果物
2. **機能的まとまり**: 関連する機能をグループ化
3. **実装順序**: 基盤→データ→UI→機能の順
4. **レビューポイント**: 各フェーズ完了時に動作確認可能

### 4.2 フェーズ構成

```
Phase 1: Setup（基盤）
    ↓
Phase 2: Types & Mocks（データ層）
    ↓
Phase 3: Layout（UI基盤）
    ↓
Phase 4: Worker Pages（労働者機能）
    ↓
Phase 5: Requester Pages + AI（発注者機能）
```

### 4.3 各フェーズの責務

| Phase | 責務 | タスク数 |
|-------|------|----------|
| 1 | 依存関係、環境変数、ディレクトリ構造、HeroUI設定 | 4 |
| 2 | 型定義、モックデータ、Zustandストア、計算ロジック | 5 |
| 3 | 背景切り替え、共通コンポーネント、レイアウト | 9 |
| 4 | 掲示板、マップ、ジョブ、ウォレット（労働者4画面） | 9 |
| 5 | ダッシュボード、詳細、評価、作成（発注者4画面）+ AI | 8 |

---

## 5. タスク設計の原則

各タスクは以下の形式で記述：

```markdown
### Task X.Y: タスク名
- **目的**: 何を達成するか
- **作業内容**: 具体的な手順（番号付き）
- **対象ファイル**: 作成/変更するファイルパス
- **完了条件**: 何をもって完了とするか
```

この形式により：
- 実装者が迷わず作業できる
- レビュー時に完了判定が明確
- 進捗管理が容易

---

## 6. 考慮した制約

1. **スマホUI前提**: max-width制限、タッチ操作を考慮
2. **モックシステム**: LocalStorage永続化、バックエンド不要
3. **時間帯背景**: リアルタイムの時刻に応じた背景切り替え
4. **UI/UX参照**: Figmaデザインへの準拠

---

## 7. 成果物

以下の計画書ファイルを作成：

```
tasks/
├── phase-1-setup.md          # 4タスク
├── phase-2-types-mocks.md    # 5タスク
├── phase-3-layout.md         # 9タスク
├── phase-4-worker-pages.md   # 9タスク
└── phase-5-requester-pages.md # 8タスク
```

合計: **35タスク**

---

## 8. 振り返り

### うまくいった点
- backupフォルダの存在により、既存実装の構造を参考にできた
- Figmaデザインにより、UIの具体的なイメージを把握できた
- ユーザーへの質問で不明点を事前に解消できた

### 改善点
- 初期段階でBunの使用を確認すべきだった（後から修正）
- ジョブページの仕様が仕様書になかったため、確認が必要だった

---

*作成者: Claude*
*計画承認後、`/exec-task`で各フェーズを実行予定*
